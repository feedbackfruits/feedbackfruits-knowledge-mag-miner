machine:
  node:
    version: 6.0.0
test:
  override:
    - "true"
deployment:
  production:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - heroku config:add GIT_TAG=`git describe --tags --always` --app fbf-knowledge-mag-miner
      - git push git@heroku.com:fbf-knowledge-mag-miner.git $CIRCLE_SHA1:refs/heads/master -f
      - heroku ps:scale web=0 -a fbf-knowledge-mag-miner
      - heroku run:detached npm start -a fbf-knowledge-mag-miner
  staging:
    branch: master
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - heroku config:add GIT_TAG=`git describe --tags --always` --app staging-fbf-knowledge-mag-mine
      - git push git@heroku.com:staging-fbf-knowledge-mag-mine.git $CIRCLE_SHA1:refs/heads/master -f
      - heroku ps:scale web=0 -a staging-fbf-knowledge-mag-mine
      - heroku run:detached npm start -a staging-fbf-knowledge-mag-mine
